#!/bin/bash

module purge
module load {{compiler}}
module load DefApps/alt
module load git/2.31.1
module load cmake/3.20.2
#module load {{mpi}}
module load craype-accel-amd-gfx908
module load {{accel}}
export HIP_PATH=$ROCM_PATH/hip # has to be set in order to be able to compile
export CMAKE_MODULE_PATH=$HIP_PATH/cmake:$CMAKE_MODULE_PATH
export CMAKE_PREFIX_PATH=$ROCM_PATH:$CMAKE_PREFIX_PATH

module load boost/1.75.0
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$BOOST_ROOT/lib
export CMAKE_PREFIX_PATH=$BOOST_ROOT:$CMAKE_PREFIX_PATH

module load c-blosc/1.21.0
module load cray-python/3.8.5.0
module load hdf5 # dependency of openpmd-api module (no other possible)
#module load cray-hdf5
module load adios2/2.7.1 # dependency of openpmd-api module
module load openpmd-api/0.13.2

module load libpng/1.6.37

# Environment #################################################################
#
# next 2 used by native picongpu build scripts
export PICSRC="/gpfs/alpine/stf006/proj-shared/OLCF5-CAAR/picongpu/nightly_tests/4afa1b86099319ba479f/picongpu"
export PIC_BACKEND="hip"
#
export PATH=$PATH:$PICSRC/bin
export PATH=$PATH:$PICSRC/src/tools/bin
export PYTHONPATH=$PICSRC/lib/python:$PYTHONPATH

export HIPCC_COMPILE_FLAGS_APPEND="$HIPCC_COMPILE_FLAGS_APPEND -I${MPICH_DIR}/include -L${MPICH_DIR}/lib -lmpi -L/opt/cray/pe/mpich/8.1.4/gtl/lib -lmpi_gtl_hsa"
